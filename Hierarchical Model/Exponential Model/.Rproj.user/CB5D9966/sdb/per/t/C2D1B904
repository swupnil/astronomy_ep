{
    "contents" : "---\ntitle: \"Simple EP\"\nauthor: \"Swupnil Sahai\"\ndate: \"July 27, 2015\"\noutput: pdf_document\n---\n\n\\section{1. Uknown Mean}\n\\subsection{Formulation}\nWe start by fitting one of the simplest possible models that isn't hierarchical in nature:\n$$ x_i \\sim N(\\phi, 1) $$\n\nGenerating 1000 data points with $\\phi = 200$, we give EP and HMC the following prior:\n$$\\phi \\sim N(0, 20)$$\n\n\\subsection{Results}\nEP and HMC converge to similar posteriors of $\\phi$, but the variance for EP decreases after the first iteration.\n\n\\begin{table}[ht]\n\\caption{Posterior of $\\phi$}\n\\centering\n\\begin{tabular}{c c c c c c c c}\n\\hline\nParameter & True & Prior & HMC & EP Iter 1 & EP Iter 2 & EP Iter 3 & EP Iter 4 \\\\ [0.5ex] % inserts table %heading\n\\hline \\\\\n$E(\\phi)$ & 200 & 0 & 199.9464 & 199.9433 & 199.9411 & 199.9426 & 199.9436 \\\\\n$SD(\\phi)$ & -- & 20 & 0.03175 & 0.03187 & 0.02531 & 0.02171 & 0.01965 \\\\\n\\hline\n\\end{tabular}\n\\label{table:nonlin}\n\\end{table}\n\n\\pagebreak\n\\section{2. Uknown Means ( + Hierarchical Mean)}\n\\subsection{Formulation}\nWe then try a slightly more interesting model with local unknown means drawn from a global uknown mean and known variance:\n$$ \\theta_j \\sim N(\\phi, 10)$$\n$$ x_{ij} \\sim N(\\theta_j, 1) $$\n\nGenerating 50 $\\theta_j$'s from $\\phi = 200$, and then sampling 1000 data points from each group $j$, we give EP and HMC the following prior:\n$$\\phi \\sim N(0, 20)$$\n\n\\subsection{Results}\nEP and HMC converge to slightly different posteriors of $\\phi$, with the location biased more and more as the number of sites is increased (i.e. as we spread the computation across more cores).\n\n\\begin{table}[ht]\n\\caption{Posterior of $\\phi$}\n\\centering\n\\begin{tabular}{c c c c c c c}\n\\hline\nParameter & True & Prior & HMC & EP K=5 & EP K=10 & EP K=25 \\\\ [0.5ex] % inserts table %heading\n\\hline \\\\\n$E(\\phi_1)$ & 200 & 0 & 200.93 & 191.09 & 188.15 & 177.06\\\\\n$SD(\\phi_1)$ & -- & 20 & 1.45 & 0.60 & 0.43 & 0.26\\\\\nTime & -- & -- & 201 s & 116 s & 95 s & 92 s\\\\ \n\\hline\n\\end{tabular}\n\\label{table:nonlin}\n\\end{table}\n\nHMC Note: HMC \"converged\"\" to strange values of $\\phi$ (e.g. 20) when using only 100 iterations per chain. This was surprising given that the $\\theta_j$'s were all being recovered perfectly, but $\\phi$ was not. This was additionally surprising given that there were a total of 50,000 data points.\n\nEP Notes: Initially estimation was terrible and I realized that I was trying make the prior sigma within each site equal to 20, which caused the prior sigma overall to be equal to 20/K (because of the way the precision is summed in EP). I then forced the overal prior sigma to be 20, causing each site to have a sigma prior of 20*K. This produced much better results.\n\n\\subsection{Re-run with Stronger Prior}\nEP performed substantially better when giving a prior of $\\phi \\sim N(200, 20)$.\n\\begin{table}[ht]\n\\caption{Posterior of $\\phi$}\n\\centering\n\\begin{tabular}{c c c c c c c c c c}\n\\hline\nParameter & True & Prior & HMC & EP K=5 & EP K=10 & EP K=25\\\\ [0.5ex] % inserts table %heading\n\\hline \\\\\n$E(\\phi_1)$ & 200 & 200 & 201.91 & 201.79 & 201.75 & 201.71\\\\\n$SD(\\phi_1)$ & -- & 20 & 1.42 & 0.604 & 0.427 & 0.26\\\\\nTime & -- & -- & 183 s & 72 s & 85 s & 127 s\\\\ \n\\hline\n\\end{tabular}\n\\label{table:nonlin}\n\\end{table}\n\n\\pagebreak\n\\section{3. Uknown Means ( + Hierarchical Mean and Variance)}\n\\subsection{Formulation}\nWe then try a model with local unknown means drawn from a global unknown mean and unknown variance:\n$$ \\theta_j \\sim N(\\phi_1, e^{\\phi_2})$$\n$$ x_{ij} \\sim N(\\theta_j, 1) $$\n\nGenerating 50 $\\theta_j$'s from $\\phi = 200$ and $e^{\\phi_2} = 5$, and then sampling 1000 data points from each group $j$, we give EP and HMC the following priors:\n$$ \\left[ \\begin{array}{c} \\phi_1 \\\\ \\phi_2 \\end{array} \\right] \n\\sim N\\biggl( \\left[ \\begin{array}{c} 0 \\\\ 0 \\end{array} \\right], \n\\left[ \\begin{array}{cc} 400 & 0 \\\\ 0 & 1 \\end{array} \\right] \\biggr)$$\n\n\\subsection{Results}\nEP performed surprisingly poorly when given a relatively non-informative prior.\n\n\\begin{table}[ht]\n\\caption{Posterior of $\\phi$}\n\\centering\n\\begin{tabular}{c c c c c c c }\n\\hline\nParameter & True & Prior & HMC & EP K=5 & EP K=10 & EP K=25 \\\\ [0.5ex] % inserts table %heading\n\\hline \\\\\n$E(\\phi_1)$ & 200 & 200 & 199.66 & 0.10 & 0.06 & 0.02 \\\\\n$SD(\\phi_1)$ & -- & 20 & 0.68 & 0.58 & 0.31 & 0.12 \\\\\n$E(\\phi_2)$ & 1.61 & 0 & 1.57 & 5.20 & 4.97 & 4.38 \\\\\n$SD(\\phi_2)$ & -- & 1 & 0.10 & 0.09 & 0.07 & 0.04 \\\\\n$Cov(\\phi_1,\\phi_2)$ & -- & 0 & -0.0064 & -0.00067 & -0.00035 & -0.00007 \\\\\nTime & -- & -- & 1137 s & 125 s & 88 s & 75 s\\\\ \n\\hline\n\\end{tabular}\n\\label{table:nonlin}\n\\end{table}\n\n\\subsection{Re-run with Stronger Prior}\nEP performed substantially better when given a prior of $\\phi \\sim N\\biggl( \\left[ \\begin{array}{c} 200 \\\\ 0 \\end{array} \\right],  \\left[ \\begin{array}{cc} 400 & 0 \\\\ 0 & 1 \\end{array} \\right] \\biggr)$.\n\n\\begin{table}[ht]\n\\caption{Posterior of $\\phi$}\n\\centering\n\\begin{tabular}{c c c c c c c }\n\\hline\nParameter & True & Prior & HMC & EP K=5 & EP K=10 & EP K=25 \\\\ [0.5ex] % inserts table %heading\n\\hline \\\\\n$E(\\phi_1)$ & 200 & 200 & 200.66 & 200.02 & 199.99 & 200.00 \\\\\n$SD(\\phi_1)$ & -- & 20 & 0.67 & 0.42 & 0.25 & 0.11 \\\\\n$E(\\phi_2)$ & 1.61 & 0 & 1.57 & 1.52 & 1.42 & 1.09 \\\\\n$SD(\\phi_2)$ & -- & 1 & 0.10 & 0.10 & 0.09 & 0.06 \\\\\n$Cov(\\phi_1,\\phi_2)$ & -- & 0 & 0.00034 & -0.0036 & -0.00015 & -0.00026 \\\\\nTime & -- & -- & 937 s & 700 s & 292 s & 237.9 s\\\\ \n\\hline\n\\end{tabular}\n\\label{table:nonlin}\n\\end{table}\n\n\n",
    "created" : 1438038774261.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4064838940",
    "id" : "C2D1B904",
    "lastKnownWriteTime" : 1438749750,
    "path" : "~/Library/Mobile Documents/com~apple~CloudDocs/School/Columbia/Research/Astronomy/Hierarchical Model/EP_Test/Simple_EP.Rmd",
    "project_path" : null,
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}